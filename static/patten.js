(function(){var u,l,y,n,p,E,r,q,z,f,A,B,v,F,H,I,J,s,Z,K,L,M,N,aa,O,ba,C,ca,da,ea,P,fa,ga,ha,ia,ja,Q,R,w,S,T,D,c,U,V,t,ka,la,ma,na,oa,g,W,X,pa,k,d,m,h,Y,G,x;r=E=p=null;d={sock:null,token:null,connected:!1,waiting_result:!1,on_err:null,hist_n:10,wd_success_timeout:null,pending_ranking_update:!1};q="0.05";z="0.000001";f=0;B=A=!1;c={width:Math.min(330,$(document).width()-10),height:320<$(document).height()?170:130,padding:16,dataset:[0,0,0,0,0,0,0,0,0,0],svg:null,xscale:null,yscale:null,updating:!1,resetting:!1};
l=0;y=1;n=null;u=[!0,null];F=/^([0-9]+)?(\.([0-9]{1,8})?)?$/;G=function(){var a,b;b=$("#bet").val().trim().replace(",",".");a=Number(b);return!F.test(b)||isNaN(a)||a<z||a>q?null:f=a};K=function(a){a.preventDefault();if(null!=G())return f*=2,Number(f)>Number(q)?f=q:F.test(f)||(f=f.toFixed(8)),$("#bet").val(f)};M=function(a){a.preventDefault();if(null!=G())return f/=2,Number(f)<Number(z)?f=z:F.test(f)||(f=f.toFixed(8)),$("#bet").val(f)};R=function(a){a.preventDefault();f=q;return $("#bet").val(f)};
Y=function(a){$("#low").removeClass("orange");$("#high").removeClass("orange");$("#high").removeClass("bold");$("#low").removeClass("bold");if(null!=a)return $(a?"#high":"#low").addClass("bold")};w=function(a,b){var e;if(null==a)console.log("bad num",a);else return e=a.toString().split("."),e[0]=e[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),null!=b&&Number(a)>=b?e[0]:e.join(".")};x=function(a,b,e){if(a.length>=b)return a;null==e&&(e="0");return(Array(b+1).join(e)+a).slice(-1*b)};Z=function(a){var b;a=
new Date(1E3*a);b=""+(""+a.getFullYear()+"-")+x(a.getMonth()+1,2)+"-"+x(a.getDate(),2);a=""+x(a.getHours(),2)+":"+x(a.getMinutes(),2)+":"+x(a.getSeconds(),2);return""+b+" "+a};ma=function(){return $("#bet").removeClass("animated shake")};la=function(){$("#inner-num").removeClass("animated flip");return u[1]=null};v=[];D=null;g=function(a,b,e){var c;null==b&&(b=3E3);null==e&&(e=0);if(a!==v[v.length-1])return v.push(a),c=function(){var e;e=$("#show-alert");e.prepend("<div class='alert alert-red'>"+
a+"</div>");return setTimeout(function(){v.pop();return e.children(".alert").first().remove()},b)},e?D=setTimeout(c,e):c()};pa=function(a,b){var e;null==b&&(b=3500);e="<div class='alert alert-blue'>"+a+"</div>";$("#show-alert").prepend(e);return setTimeout(function(){return $("#show-alert").children(".alert").first().remove()},b)};ia=function(){v.length=0;$(".alert").remove();if(null!=D)return clearTimeout(D),D=null};J=function(a){a.preventDefault();return L(!1)};I=function(a){a.preventDefault();
return L(!0)};L=function(a){var b;if(d.waiting_result||A)d.waiting_result?g("Still waiting for the last result",3E3,3E3):g("Still waiting for an action");else if(B=!0,Y(a),b=G(),null===b)$("#bet").addClass("animated shake"),setTimeout(ma,1500),P({error:"Bet not placed",result:-1}),$("#high").addClass("orange"),$("#low").addClass("orange");else return a={type:"bet",high:a,amount:b.toString()},k(a)};P=function(a){var b,e;B=!1;null===a.pattern?($("#low").addClass("orange"),$("#high").addClass("orange")):
0<=a.result&&(A=!0);if(null!=a.error)g(a.error);else{ia();$("#nonce").val(a.nonce);X(a.stats);$("#num").removeClass("lose");$("#num").removeClass("win");$("#profit").removeClass("lose");$("#profit").removeClass("win");b=a.result;$("#num").text(b);a.win?($("#profit").text("+"+a.profit_display),u[0]&&null===u[1]&&($("#inner-num").addClass("animated flip"),u[1]=setTimeout(la,1100)),$("#profit").addClass("win"),$("#num").addClass("win")):($("#num").addClass("lose"),$("#profit").addClass("lose"),$("#profit").text(a.profit_display),
u[0]&&$("#inner-num").removeClass("animated flip"));$("#balance").text(a.balance_display);c.dataset[b]++;t();if(10>c.dataset[b])d3.select("#marker-"+b).style("display","none");else if(10===c.dataset[b])d3.select("#marker-"+b).style("display","block");else if(10<c.dataset[b]){for(b=e=0;9>=e;b=e+=1)c.dataset[b]=0,d3.select("#marker-"+b).style("display","none");setTimeout(t,300)}if(null!==a.pattern)return $("#pattern").text(a.pattern),$("#pattern-action").show(),H()}};H=function(){var a;l=0;y=1;null!==
n&&(clearInterval(n),n=null);a=function(){var a;if(!c.updating){a="#rect-"+l;d3.select(a).attr("fill","orange");d3.select(a).transition().duration(300).attr("fill","black");l+=y;if(11===l)return l-=1,y=-1;if(-2===l)return l+=1,y=1}};return setTimeout(function(){return n=setInterval(a,50)},150)};t=function(a){var b;c.updating=!0;c.yscale=d3.scale.linear().domain([0,d3.max(c.dataset)]).range([c.padding,c.height-c.padding]);c.svg.selectAll("rect").data(c.dataset).transition().duration(125).attr("y",
function(a){return c.height-c.padding-c.yscale(a)}).attr("height",function(a){return c.yscale(a)-c.padding});c.svg.selectAll("text").data(c.dataset).text(function(a){return a}).attr("y",function(a){return c.height-c.padding-c.yscale(a)+16});b=function(){clearInterval(n);n=null;return c.updating=!1};return a?b():setTimeout(b,125)};V=function(a){return k({type:"reset",counter:a})};U=function(a){var b,e;for(b=e=0;9>=e;b=e+=1)c.dataset[b]=0,d3.select("#marker-"+b).style("display","none");return t(a)};
ca=function(a){d3.select("#marker-"+a).style("display","none");c.dataset[Number(a)]=0;return t()};C=function(a,b,e){$("#pattern").text("None");$("#pattern-action").hide();c.updating=!0;clearInterval(n);b=function(){A=!1;$("#low").addClass("orange");$("#high").addClass("orange");c.svg.selectAll("rect").attr("fill","black");t(e);if(!a)return U(e)};return e?b():setTimeout(b,300)};S=function(){return k({type:"pattern-collect"})};T=function(){return k({type:"pattern-continue"})};X=function(a){var b,e,
c,d,f;if(null==a)for(c=["#myprofit","#nbet","#nwin","#npattern","#wagered"],b=0,e=c.length;b<e;b++)a=c[b],$(a).text("Error");else{W(a.ranking);$("#myprofit").text(w(a.profit));$("#wagered").text(w(a.wagered));d=[["#nbet",a.nbet],["#nwin",a.nwin],["#npattern",a.npatt]];f=[];e=0;for(c=d.length;e<c;e++)a=d[e],$(a[0]).text(w(a[1])),b=a[0].substr(2),1!==Number(a[1])?f.push($(""+a[0]+"-text").text(""+b+"s")):f.push($(""+a[0]+"-text").text(""+b));return f}};W=function(a){return 0<Number(a)?$("#ranking").text("#"+
w(a)):$("#ranking").text("Unranked")};da=function(a){d.pending_ranking_update=!1;if(null!=a.error)g(a.error);else return W(a.ranking)};ka=function(){if(d.pending_ranking_update)return k({type:"ranking"})};oa=function(){var a,b;c.xscale=d3.scale.ordinal().domain(d3.range(c.dataset.length)).rangeRoundBands([0,c.width],0.05);c.yscale=d3.scale.linear().domain([0,d3.max(c.dataset)]).range([c.padding,c.height-c.padding]);c.svg=d3.select("#plot").append("svg:svg").attr("width",c.width).attr("height",c.height).attr("class",
"chart");for(a=b=0;9>=b;a=b+=1)c.svg.append("svg:line").attr("class","line").attr("id","marker-"+a).attr("x1",c.xscale(a)+c.xscale.rangeBand()/2).attr("y1",0).attr("x2",c.xscale(a)+c.xscale.rangeBand()/2).attr("y2",c.height-2*c.padding).style("stroke","red").style("stroke-width",c.xscale.rangeBand()+4).style("display","none");c.svg.selectAll("rect").data(c.dataset).enter().append("rect").attr("id",function(a,b){return"rect-"+b}).attr("x",function(a,b){return c.xscale(b)}).attr("width",c.xscale.rangeBand()).attr("fill",
function(a){return"black"}).on("mouseenter",function(){return c.updating?!1:d3.select(this).attr("fill","orange")}).on("mouseleave",function(a){return c.updating?!1:d3.select(this).transition().duration(300).attr("fill","black")});c.svg.selectAll("rect").on("click",function(a,b){d3.event.stopPropagation();d3.select(this).attr("fill","black");return V(b)});c.svg.selectAll("text").data(c.dataset).enter().append("text").text(function(a){return a}).attr("text-anchor","middle").attr("x",function(a,b){return c.xscale(b)+
c.xscale.rangeBand()/2}).attr("y",function(a){return c.height-c.padding-c.yscale(a)+16}).attr("fill","white");a=d3.svg.axis().scale(c.xscale);return c.svg.append("g").attr("class","axis").attr("transform","translate(0, "+(c.height-2*c.padding)+")").call(a)};na=function(){var a,b,c;Mousetrap.bind("k",T);Mousetrap.bind("t",S);Mousetrap.bind("a",J);Mousetrap.bind("b",I);Mousetrap.bind("x",K);Mousetrap.bind("c",M);Mousetrap.bind("m",R);c=[];for(a=b=0;9>=b;a=b+=1)c.push(Mousetrap.bind(a.toString(),function(a){a=
String.fromCharCode(a.which);V(a);return!1}));return c};k=function(a){if(!d.waiting_result){if(d.connected)return d.waiting_result=!0,a.token=d.token,d.sock.send(JSON.stringify(a));d.waiting_result=!1;g("Not connected");if(null!=d.on_err)return d.on_err(),d.on_err=null}};Q=function(a,b){return k({type:"login",user:a,pwd:b})};ba=function(a){d.token=a.token;$("#jackpot").text(a.jackpot);$(".edge").text(""+a.edge+"%");$(".edge-ex").text(a.edge_example);$("#jpincr").text(a.jp_incr);z=a.min_bet;return q=
a.max_bet};$("#new-useed").click(function(){this.focus();return this.select()});ea=function(a){if(null!=a.error)$("#reseed").addClass("orange"),g(a.error);else return $("#reseed").hide(),$("#reseeding").show(),$("#sseed").val(a.old_secret),$("#new-sshash").val(a.new_sshash),$("#new-useed").val(a.initial_useed),$("#new-useed").click()};ga=function(a){if(null!=a.error)g(a.error);else return $("#reseeding").hide(),$("#reseed").addClass("orange"),$("#reseed").show(),$("#sseed").val(""),$("#nonce").val("1"),
$("#useed").val($("#new-useed").val()),$("#sshash").val($("#new-sshas").val()),$("#new-sshash").val(""),$("#new-useed").val("")};ha=function(a){$("#send-coins").addClass("orange");if(null!=a.error)g(a.error);else return $("#wd-samount").text(a.amount),$("#wd-toaddr").text(a.toaddr),$("#wd-txid").text(a.txid),$("#wd-success").show(),a=function(){d.wd_success_timeout=null;return $("#wd-success").hide()},d.wd_success_timeout&&clearTimeout(d.wd_success_timeout),d.wd_success_timeout=setTimeout(a,12E4)};
fa=function(a){if(null!=a.error)g("Signup error: "+a.error),d.on_err();else if(a.created)return Q($("#new-user").val(),$("#new-pwd").val()),$("#new-user").val(""),$("#new-pwd").val(""),h("#signup"),$("#send-signup").addClass("orange")};aa=function(a){var b,e;$("#send-login").addClass("orange");if(null!=a.error)g("Login error: "+a.error);else if(a.login){$("#user").val("");$("#pwd").val("");$("#show-login").hide();$("#show-signup").hide();$("#show-account").show();$("#do-logout").show();$("#login-text").text("Logged in");
$("#num").text("?");$("#num").removeClass("win");$("#num").removeClass("lose");$("#profit").text("");E=a.balance;r=a.address;p=a.login;$("#balance-text").text("Bitcoins");$("#balance").text(E);$("#username").text(""+p+" (#"+a.uid+")");$("#addr").val(r);d.pending_ranking_update=!1;X(a.stats);$("#nonce").val(a.nonce);$("#useed").val(a.useed);$("#sshash").val(a.sshash);b=$("#history tbody");b.empty();N(a.hist,!1);a.hist=null;"undefined"!==typeof m&&null!==m&&h("#login");C(!1,0,!0);for(b=e=0;9>=e;b=e+=
1)c.dataset[b]=a.game[b],10===a.game[b]&&d3.select("#marker-"+b).style("display","block");t();if(a.hit_pattern)return A=!0,$("#low").removeClass("orange"),$("#high").removeClass("orange"),$("#pattern").text(a.hit_pattern),$("#pattern-action").show(),H()}};O=function(){E=r=p=null;h(m);$("#balance-text").text("Free play");$("#balance").text("-");$("#login-text").text("No user");$("#show-account").hide();$("#do-logout").hide();$("#show-login").show();$("#show-signup").show();$("#low").addClass("orange");
$("#high").addClass("orange");$("#wd-success").hide();$("#addr").val("");$("#reseeding").hide();$("#reseed").addClass("orange");$("#reseed").show();$("#sseed").val("");$("#new-sshash").val("");$("#new-useed").val("");d.wd_success_timeout&&(clearTimeout(d.wd_success_timeout),d.wd_success_timeout=null);$("#wd-success").hide();$("#wd-samount").text("");$("#wd-toaddr").text("");$("#wd-txid").text("");$("#send-coins").addClass("orange");return C(!1,0)};N=function(a,b){var c,f,g,k,h,l;if(b)for(;$("#history tbody tr").length+
a.length>d.hist_n;)$($("#history tbody tr")[0]).remove();c="";h=0;for(l=a.length;h<l;h++)g=a[h],g=$.parseJSON(g),k="<td class='hist-when'>"+Z(g.when)+"</td>",f=$("<div/>").text(g.descr).html(),f="<td class='hist-descr'>"+f+"</td>",c+="<tr><td style='text-align: center'>"+g.id+"</td>"+k+f+"</tr>";return $("#history tbody").append(c)};m=null;h=function(a){if(a===m)return $("#wrapper-menu-item").hide(),null!=a&&$(a).toggle(),m=null,Mousetrap.unpause(),!1;null!=m?($(m).hide(),$(a).show()):($("#wrapper-menu-item").toggle(),
$(a).toggle(),Mousetrap.pause());m=a;return!0};ja=function(a,b){if(a)return bitcoin.getTransaction(b,function(a){return alert("Thanks! "+a.amount/bitcoin.BTC_IN_SATOSHI+" BTC was just sent to user "+p+". Now you just need to wait for 1 confirmation.")})};s=function(a,b){var c,d,f,g;g=[];d=0;for(f=a.length;d<f;d++)c=a[d],g.push($(c).keyup(function(a){if(13===a.keyCode)return $(b).click(),a.preventDefault()}));return g};(function(){d.on_open=function(){d.connected=!0;$("#connecting").hide();$("#top-status").show();
$("#bottom-status").show();$("#send-login").addClass("orange");$("#low").addClass("orange");$("#high").addClass("orange");return U()};d.on_close=function(){d.connected=!1;O();$("#top-status").hide();$("#bottom-status").hide();$("#connecting").show();$("#low").removeClass("orange");$("#high").removeClass("orange");return $("#send-login").removeClass("orange")};d.on_message=function(a){a=$.parseJSON(a.data);d.waiting_result=!1;switch(a.type){case "open":ba(a);break;case "bet":P(a);break;case "reset":ca(a.counter);
break;case "signup":fa(a);break;case "reseed":ea(a);break;case "userseed":ga(a);break;case "login":aa(a);break;case "logout":O();break;case "pattern-collect":C(!1,a.amount);$("#balance").text(a.balance);$("#myprofit").text(w(a.profit));break;case "pattern-continue":C(!0);break;case "ranking":da(a);break;case "bet-update":$("#jackpot").text(a.jackpot);null!=a.max_bet&&($("#bet").val()===q&&$("#bet").val(a.max_bet),q=a.max_bet,null!=p&&(d.pending_ranking_update=!0));break;case "balance":$("#balance").text(a.balance);
break;case "address":r=a.address;$("#addr").val(a.address);break;case "withdraw":ha(a);break;case "warning":pa(a.warning);break;case "hist":break;case "error":g("Error: "+a.reason);B&&(B=!1,$("#low").addClass("orange"),$("#high").addClass("orange"));null!=d.on_err&&(d.on_err(),d.on_err=null);break;default:g("Unknown message '"+a.type+"'")}if(null!=a.hist&&a.hist.length)return N(a.hist,!0)};d.sock=new SockReconnect("https://gl.dice.gg/sock",null,null,d.on_message,d.on_open,d.on_close);d.sock.connect();
Y(null);setInterval(ka,1E4);$("#pattern").text("None");$("#pattern-action").hide();$("#pattern-collect").click(function(a){a.preventDefault();return S()});$("#pattern-continue").click(function(a){a.preventDefault();return T()});oa();$("#low").click(J);$("#high").click(I);$("#doubleit").click(K);$("#halfit").click(M);$("#maxit").click(R);na();$("#show-login").click(function(a){a.preventDefault();if(h("#login"))return $("#user").focus()});$("#send-login").click(function(a){var b;a.preventDefault();
b=$("#user").val().trim();a=$("#pwd").val();if(b&&a)return $("#send-login").removeClass("orange"),Q(b,a);g("Fill all the fields");$("#user").focus()});$("#show-deposit").click(function(a){a.preventDefault();return null!=p?(30>$("#addr").val().length&&k({type:"address",coin:"BTC"}),h("#deposit")):h("#deposit-nologin")});$("#show-withdraw").click(function(a){a.preventDefault();return null!=p?h("#withdraw"):h("#deposit-nologin")});$("#show-help").click(function(a){a.preventDefault();return h("#help")});
$("#show-signup").click(function(a){a.preventDefault();if(h("#signup"))return $("#new-user").focus()});$("#send-signup").click(function(a){var b,c;a.preventDefault();c=$("#new-user").val().trim();a=$("#new-pwd").val();b=$("#new-pwd-check").val();if(c){if(a&&a===b)return $("#send-signup").removeClass("orange"),d.on_err=function(){return $("#send-signup").addClass("orange")},a={type:"signup",user:c,pwd:a},k(a);g("Check the passwords")}else g("Username is required")});"undefined"===typeof bitcoin||null===
bitcoin?($("#lbl-addr").show(),$("#send-hive").hide()):($("#lbl-addr").hide(),$("#send-hive").show());$("#send-hive").click(function(a){a.preventDefault();if("undefined"!==typeof bitcoin&&null!==bitcoin)return r?bitcoin.sendMoney(r,null,ja):g("No address defined")});$("#show-account").click(function(a){a.preventDefault();return h("#account")});$("#hide-seed").click(function(a){$("#fair-seed").toggle();return $("#hide-seed").text("none"!==$("#fair-seed").css("display")?"Hide":"Show")});$("#hide-history").click(function(a){$("#history").toggle();
return $("#hide-history").text("none"!==$("#history").css("display")?"Hide":"Show")});$("#hide-stats").click(function(a){$("#stats").toggle();return $("#hide-stats").text("none"!==$("#stats").css("display")?"Hide":"Show")});$("#reseed").click(function(a){a.preventDefault();$("#reseed").removeClass("orange");d.on_err=function(){return $("#reseed").addClass("orange")};return k({type:"reseed"})});$("#send-useed").click(function(a){a.preventDefault();return(a=$("#new-useed").val().trim())?k({type:"userseed",
seed:a}):g("No seed entered")});$("#send-coins").click(function(a){var b;b=$("#wd-amount").val().trim();a=$("#wd-addr").val().trim();if(b&&a)if(1.6E-4>Number(b))g("Amount is below minimum");else return $("#send-coins").removeClass("orange"),k({type:"withdraw",amount:b,toaddr:a});else g("All fields are required")});$("#do-logout").click(function(a){a.preventDefault();return k({type:"logout"})});s(["#user","#pwd"],"#send-login");s(["#new-user","#new-pwd","#new-pwd-check"],"#send-signup");s(["#wd-amount"],
"#send-coins");s(["#secemail"],"#send-email");s(["#wd-lock"],"#send-wdlock");s(["#new-useed"],"#send-useed");setInterval(function(){return $("#num").toggleClass("highlight")},1500);return $("#bet").focus()})()}).call(this);
